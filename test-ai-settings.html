<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Configura√ß√µes de IA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #49a09d;
            margin-top: 0;
        }
        button {
            background: #49a09d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #3a8582;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: green; }
        .error { color: red; }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de Configura√ß√µes de IA</h1>
    <p>Use esta p√°gina para testar todas as funcionalidades das configura√ß√µes de IA</p>

    <!-- TESTE 1: Carregar Configura√ß√µes -->
    <div class="test-section">
        <h2>1Ô∏è‚É£ Carregar Configura√ß√µes</h2>
        <p>Simula login de usu√°rio e carrega configura√ß√µes do banco</p>
        <label>User ID: <input type="number" id="userId" value="1"></label>
        <button onclick="testLoadSettings()">Carregar Configura√ß√µes</button>
        <div id="loadResult" class="result"></div>
    </div>

    <!-- TESTE 2: Salvar Configura√ß√µes -->
    <div class="test-section">
        <h2>2Ô∏è‚É£ Salvar Configura√ß√µes</h2>
        <p>Salva novas configura√ß√µes no banco</p>
        <label>
            <input type="checkbox" id="descriptionsEnabled" checked> Descri√ß√µes Autom√°ticas
        </label><br>
        <label>
            N√≠vel:
            <select id="detailLevel">
                <option value="baixo">Baixo</option>
                <option value="medio" selected>M√©dio</option>
                <option value="alto">Alto</option>
            </select>
        </label><br>
        <label>
            <input type="checkbox" id="optimizationEnabled" checked> Otimiza√ß√£o
        </label><br>
        <button onclick="testSaveSettings()">Salvar no Banco</button>
        <div id="saveResult" class="result"></div>
    </div>

    <!-- TESTE 3: Gerar Descri√ß√£o -->
    <div class="test-section">
        <h2>3Ô∏è‚É£ Gerar Descri√ß√£o com IA</h2>
        <p>Testa a gera√ß√£o de descri√ß√£o autom√°tica</p>
        <label>
            T√≠tulo da tarefa:
            <input type="text" id="taskTitle" value="Estudar React hooks" style="width: 300px;">
        </label><br>
        <label>
            N√≠vel de detalhamento:
            <select id="genDetailLevel">
                <option value="baixo">Baixo (~20 palavras)</option>
                <option value="medio" selected>M√©dio (~30-50 palavras)</option>
                <option value="alto">Alto (~60-100 palavras)</option>
            </select>
        </label><br>
        <button onclick="testGenerateDescription()">Gerar Descri√ß√£o</button>
        <div id="genResult" class="result"></div>
    </div>

    <!-- TESTE 4: Verificar Banco -->
    <div class="test-section">
        <h2>4Ô∏è‚É£ Verificar Banco de Dados</h2>
        <p>Mostra todas as configura√ß√µes de IA armazenadas</p>
        <button onclick="testCheckDatabase()">Verificar Banco</button>
        <div id="dbResult" class="result"></div>
    </div>

    <script>
        const API_URL = window.location.hostname === 'localhost'
            ? 'http://localhost:3000'
            : 'https://basetestenura-3.onrender.com';

        function log(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = 'result ' + (isError ? 'error' : 'success');
        }

        async function testLoadSettings() {
            const userId = document.getElementById('userId').value;
            log('loadResult', 'Carregando...');

            try {
                const response = await fetch(`${API_URL}/api/settings/${userId}`, {
                    headers: {
                        'x-user-id': userId
                    }
                });

                const data = await response.json();

                if (data.success) {
                    log('loadResult',
                        `‚úÖ Configura√ß√µes carregadas!\n\n` +
                        `Descri√ß√µes Autom√°ticas: ${data.settings.aiDescriptionsEnabled ? 'ATIVADO' : 'DESATIVADO'}\n` +
                        `N√≠vel de Detalhamento: ${data.settings.aiDetailLevel}\n` +
                        `Otimiza√ß√£o: ${data.settings.aiOptimizationEnabled ? 'ATIVADO' : 'DESATIVADO'}\n\n` +
                        JSON.stringify(data.settings, null, 2)
                    );

                    // Atualizar campos do formul√°rio
                    document.getElementById('descriptionsEnabled').checked = data.settings.aiDescriptionsEnabled;
                    document.getElementById('detailLevel').value = data.settings.aiDetailLevel;
                    document.getElementById('optimizationEnabled').checked = data.settings.aiOptimizationEnabled;
                } else {
                    log('loadResult', `‚ùå ${data.error}`, true);
                }
            } catch (error) {
                log('loadResult', `‚ùå Erro: ${error.message}`, true);
            }
        }

        async function testSaveSettings() {
            const userId = document.getElementById('userId').value;
            const descriptionsEnabled = document.getElementById('descriptionsEnabled').checked;
            const detailLevel = document.getElementById('detailLevel').value;
            const optimizationEnabled = document.getElementById('optimizationEnabled').checked;

            log('saveResult', 'Salvando...');

            try {
                const response = await fetch(`${API_URL}/api/settings/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-user-id': userId
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        settings: {
                            hideCompleted: false,
                            highlightUrgent: true,
                            autoSuggestions: true,
                            detailLevel: 'M√©dio',
                            darkMode: false,
                            primaryColor: '#49a09d',
                            currentPlan: 'pro',
                            planRenewalDate: '30 de dezembro de 2025',
                            viewMode: 'lista',
                            emailNotifications: true,
                            aiDescriptionsEnabled: descriptionsEnabled,
                            aiDetailLevel: detailLevel,
                            aiOptimizationEnabled: optimizationEnabled
                        }
                    })
                });

                const data = await response.json();

                if (data.success) {
                    log('saveResult',
                        `‚úÖ Configura√ß√µes salvas com sucesso!\n\n` +
                        `Descri√ß√µes: ${descriptionsEnabled ? 'ATIVADO' : 'DESATIVADO'}\n` +
                        `N√≠vel: ${detailLevel}\n` +
                        `Otimiza√ß√£o: ${optimizationEnabled ? 'ATIVADO' : 'DESATIVADO'}`
                    );
                } else {
                    log('saveResult', `‚ùå ${data.error}\n${data.details || ''}`, true);
                }
            } catch (error) {
                log('saveResult', `‚ùå Erro: ${error.message}`, true);
            }
        }

        async function testGenerateDescription() {
            const taskTitle = document.getElementById('taskTitle').value;
            const detailLevel = document.getElementById('genDetailLevel').value;

            log('genResult', 'Gerando descri√ß√£o com IA...');

            try {
                const response = await fetch(`${API_URL}/api/ai/generate-description`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        taskTitle,
                        detailLevel
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const wordCount = data.description.split(' ').length;
                    log('genResult',
                        `‚úÖ Descri√ß√£o gerada!\n\n` +
                        `Tarefa: "${data.taskTitle}"\n` +
                        `N√≠vel: ${data.detailLevel}\n` +
                        `Palavras: ${wordCount}\n\n` +
                        `Descri√ß√£o:\n"${data.description}"`
                    );
                } else {
                    log('genResult', `‚ùå ${data.error}`, true);
                }
            } catch (error) {
                log('genResult', `‚ùå Erro: ${error.message}`, true);
            }
        }

        async function testCheckDatabase() {
            const userId = document.getElementById('userId').value;
            log('dbResult', 'Verificando banco...');

            try {
                const response = await fetch(`${API_URL}/api/settings/${userId}`, {
                    headers: {
                        'x-user-id': userId
                    }
                });

                const data = await response.json();

                if (data.success) {
                    log('dbResult',
                        `‚úÖ Dados no banco de dados:\n\n` +
                        JSON.stringify(data.settings, null, 2)
                    );
                } else if (response.status === 404) {
                    log('dbResult',
                        `‚ö†Ô∏è Nenhuma configura√ß√£o encontrada para o usu√°rio ${userId}\n\n` +
                        `Clique em "Salvar no Banco" para criar configura√ß√µes.`
                    );
                } else {
                    log('dbResult', `‚ùå ${data.error}`, true);
                }
            } catch (error) {
                log('dbResult', `‚ùå Erro: ${error.message}`, true);
            }
        }

        // Simular login local
        localStorage.setItem('nura_user', JSON.stringify({
            id: 1,
            name: 'Usu√°rio Teste',
            email: 'teste@nura.com'
        }));

        console.log('üß™ P√°gina de teste carregada!');
        console.log('üìù User ID simulado: 1');
        console.log('üåê API URL:', API_URL);
    </script>
</body>
</html>
